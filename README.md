# Definition

This tool is a standardised framework for optimising the management of energy within renewable energy communities. It’s capable of optimising the sharing of energy within the community for communities with solar panels and/or batteries, as well as the operation of the batteries for the day ahead.

## Parameters

### List of parameters

- #### Users

  - <img src="https://latex.codecogs.com/gif.latex? I" alt="Alternate text">

  - Diferent users identifiers for the different users for the energy comunity.

- #### Time

  - <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

  - Diferent timestamps identifying set.

- #### Power consumed

  - Units:[kW]
  
  - <img src="https://latex.codecogs.com/gif.latex?P\_Consumed[i,t] " alt="Alternate text"/>

  - Power consumed by the end user at the start of the optimitzation.
Is represented as power but sometimes is used with energy, if it's that case convert it to powet if $At$ is different than 1.

- #### Energy price for consumption

  - Units:[€/kWh]

  - <img src="https://latex.codecogs.com/gif.latex?Ecost[i,t] "
alt="Alternate text"/>

  - Energy price for consumption depending of the client and time.

- #### Energy price for injection

  - Units:[€/kWh]

  - <img src="https://latex.codecogs.com/gif.latex?Ecost\_sell[i,t] " alt="Alternate text"/>

  - Energy price for injection depending of the client and time.

- #### Period

  - Units:[h]

  - <img src="https://latex.codecogs.com/gif.latex?At " alt="Alternate text"/>

  - By default is one hour.

- #### Photovoltaic plant

  - <img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

  - Photovoltaic plant identifying set.

- #### Photovoltaic Power

  - Units:[kW]

  - <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv] " alt="Alternate text"/>

  - Energy generated by each photovoltaic plant.

- #### Par Photovoltaic Sharing Factor

  - Units:[pu]

  - <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

  - The defined sharing factors per unit, for each timestamp, client and photovoltaic plant.

- #### Inversion PV

  - <img src="https://latex.codecogs.com/gif.latex?Inv\_PV[i,pv] " alt="Alternate text"/>

  - Inversion for each client and each photovoltaic plant.

- #### Battery

  - <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

  - Batery identifier.

- #### Maximum battery energy

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?EBat\_max[bat] " alt="Alternate text"/>

  - Maximum energy that can be stored in the battery.

- #### Minimum battery energy

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?EBat\_min[bat] " alt="Alternate text"/>

  - Minimum energy that can be stored in the battery.

- #### Maximum battery power

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?PBat\_max[bat] " alt="Alternate text"/>

  - Maximum power that the battery inverter can work

- #### Par Battery Sharing Factor

  - Units:[pu]

  - <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] " alt="Alternate text"/>

  - Is the defined sharing factors per unit, for each timestamp, client and battery.

- #### Battery inversion

  - Units:[€]

  - <img src="https://latex.codecogs.com/gif.latex?Inv\_Bat[i,bat] " alt="Alternate text"/>

  - Inversion for each client of the battery.

- #### Initial Batery level

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?EBat\_0[bat] " alt="Alternate text"/>

  - Initial energy stored in the battery

- #### Final Batery level

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?EBat\_end[bat] " alt="Alternate text"/>

  - Final energy stored in the battery. By default equal to the initial energy.

- #### Maximum daily cicles

  - <img src="https://latex.codecogs.com/gif.latex?nmax[Bat] " alt="Alternate text"/>

  - Maximum daily cicles que puede hacer una bateria.

### List of Variables

Llistat de totes les variables. Bàsicament variables resultats.

- #### Overall cost for a client

  - Units:[€]

  - <img src="https://latex.codecogs.com/gif.latex?Cost[i] " alt="Alternate text"/>

  - Overall cost of the optimitzation fo each client

- #### Var Photovoltaic Sharing Factor

  - Units:[pu]

  - <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

  - The defined sharing factors per unit, for each timestamp, client and photovoltaic plant

- #### Return of inversion PV constant

  - <img src="https://latex.codecogs.com/gif.latex?Payback\_CTE\_PV[pv] " alt="Alternate text"/>

  - Variable to limit that the Payback of a specific PV is equal for all the clients that take part in the pv.

- #### Var Battery Sharing Factor

  - Units:[pu]

  - <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] " alt="Alternate text"/>

  - Is the defined sharing factors per unit, for each timestamp, client and battery.

- #### Battery Charge power

  - Units:[kW]

  - <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[t,bat] " alt="Alternate text"/>

  - Power that the battery will charge each battery each timestamp.

- #### Battery Discharge power

  - Units:[kW]

  - <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[t,bat] " alt="Alternate text"/>

  - Power that the battery will discharge each battery each timestamp.

- #### Battery Energy

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?EBat[t,bat] " alt="Alternate text"/>

  - Energy stored in each Battery each timestamp.

- #### Power consumed bill

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill[i,t] " alt="Alternate text"/>

  - Power consumed billed, as result of the energy community sharing of energy.

- #### Power injected bill

  - Units:[kWh]

  - <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill[i,t] " alt="Alternate text"/>

  - Power injected to the grid billed, as result of the energy community sharing of energy.

- #### Return of inversion

  - <img src="https://latex.codecogs.com/gif.latex?Payback[i] " alt="Alternate text"/>**

  - General payback without descrimination from where the return of inversion comes.

- #### Return of inversion PV

  - <img src="https://latex.codecogs.com/gif.latex?Payback\_PV[i,pv] " alt="Alternate text"/>

  - Return of inversion for just the photovoltaic panels.

- #### Return of inversion Bat

  - <img src="https://latex.codecogs.com/gif.latex?Payback\_Bat[i,bat] " alt="Alternate text"/>

  - Return of inversion for just the battery.

- #### Return of inversion Bat constant

  - <img src="https://latex.codecogs.com/gif.latex?Payback_CTE_Bat[pv] " alt="Alternate text"/>

  - Variable to limit that the Payback of a specific Battery is equal for all the clients that have inverted in the Battery.

## Constrains

List of the number of constrains that can be used in the library.

- ### Solar sharing factors constrain

  - Limitation for the solar sharings
  
  - #### Solar sharing factors with no battery or without bateries charging from solar

  - <img src="https://latex.codecogs.com/gif.latex?1= \sum_{i=0} ^{I} SF\_V\_PV[i,t,pv]  \quad \forall pv \in PV, \forall t \in T" alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Photovoltaic plant](#photovoltaic-plant) :<img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

      - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or
[Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor)
[pu]:<img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

  - #### Solar sharing factors where only charging from solar

    - There only one battery for client. But the client can be in several PV.

    - <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv]= \sum_{i=0} ^I
\left(  P\_PV[t,pv]\cdot SF\_PV[i,t,pv] +\sum_{bat=0}^{Bat } PBat\_ch[t,bat] \right)  \\ \forall pv \in PV, \forall t \in T"
alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV " alt="Alternate text"/>

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Photovoltaic plant](#photovoltaic-plant) : <img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

      - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor)
or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor) [pu]:<img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] "
alt="Alternate text"/>

      - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

      - [Battery Charge power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

  - #### Solar sharing factors where only charging from solar with sharing factors

    - There only one battery for client. But the client can be in several PV.

    - <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv]= \sum_{i=0} ^I \left(  P\_PV[t,pv]\cdot SF\_PV[i,t,pv] +\sum_{bat=0}^{Bat }
SF\_Bat[i,t,bat] \cdot PBat\_ch[t,bat] \right)  \\ \forall pv \in PV, \forall t \in T" alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV " alt="Alternate text"/>

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Photovoltaic plant](#photovoltaic-plant) : <img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

      - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

      - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor)
[pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

      - [Par Battery Sharing Factor](#par-battery-sharing-factor) or [Var Battery Sharing Factor](#var-battery-sharing-factor)
[pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] " alt="Alternate text"/>

      - [Battery Charge power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/> .

- ### Battery sharing factors constrain

  - Limits the value of the sharing factors of the battery to per unit.

  - <img src="https://latex.codecogs.com/gif.latex?1= \sum_{t=0}^T\sum_{i=0} ^I SF\_Bat[i,bat,t]  \quad \forall bat \in Bat" alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

    - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

    - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor)
[pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

- ### Power balance

  - The power balance set get the final bill of the client

  - #### Power balance with battery only charging from solar

    - <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill[i,t]-P\_injected\_bill[i,t] = P\_Consumed[i,t] \\-\sum_{pv=0}^{PV}
P\_PV[t,pv] \cdot SF\_PV[i,t,pv] \\- \sum_{bat=0}^{Bat}  P\_Bat\_dch[t,bat] \cdot SF\_Bat[i,t,bat] \\   \quad \forall i \in T,\forall i \in I"
alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

    - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

    - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor)
[pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

    - [Par Battery Sharing Factor](#par-battery-sharing-factor) or [Var Battery Sharing Factor](#var-battery-sharing-factor)
[pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] " alt="Alternate text"/>

    - [Battery Disharge power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

    - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV " alt="Alternate text"/>

    - [Power Consumed](#power-consumed) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed " alt="Alternate text"/>

    - [Power Consumed Bill](#power-consumed-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill " alt="Alternate text"/>

    - [Power Injected Bill](#power-injected-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill " alt="Alternate text"/>

  - #### Power balance with battery discharge with the sharing factor

    - <img src="https://latex.codecogs.com/gif.latex?P\_consumed[i,t]-P\_injected[i,t] = P\_consumed\_or[i,t] \\- \sum_{pv=0}^{PV}
P\_PV[t,pv] \cdot SF\_PV[i,t,pv] \\-\sum_{bat=0}^{Bat}  PBat\_ch[t,bat] \cdot SF\_Bat[i,t,bat]\\+ \sum_{bat=0}^{Bat}  PBat\_dch[t,bat]
\cdot SF\_Bat[i,t,bat]\quad \\  \forall i \in T,\forall i \in I" alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

    - [Photovoltaic plant](#photovoltaic-plant) : <img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

    - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

    - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor)
[pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

    - [Par Battery Sharing Factor](#par-battery-sharing-factor) or [Var Battery Sharing Factor](#var-battery-sharing-factor)
[pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] " alt="Alternate text"/>

    - [Battery Charge power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

    - [Battery Disharge power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

    - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv] " alt="Alternate text"/>

    - [Power Consumed](#power-consumed) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed[i,t] " alt="Alternate text"/>

    - [Power Consumed Bill](#power-consumed-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill[i,t] " alt="Alternate text"/>

    - [Power Injected Bill](#power-injected-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill[i,t] " alt="Alternate text"/>

- ### Cost definition

  - Caclulates the cost of each client.

  - <img src="https://latex.codecogs.com/gif.latex?Cost[i] = \sum_{t=0}^T P\_Consumed\_bill[i,t] \cdot At \cdot Ecost[i,t]-P\_Injected\_bill
[i,t]\cdot At\cdot    Ecost\_sell[i,t] \quad\forall i \in I " alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

    - [Period](#period): <img src="https://latex.codecogs.com/gif.latex?At " alt="Alternate text"/>

    - [Overall Cost-for-a-Client](#overall-cost-for-a-client): <img src="https://latex.codecogs.com/gif.latex?Cost[i] " alt="Alternate text"/>

    - [Energy Price for Consumption](#energy-price-for-consumption): <img src="https://latex.codecogs.com/gif.latex?Ecost[i,t] " alt="Alternate text"/>

    - [Energy Price for Injection](#energy-price-for-injection): <img src="https://latex.codecogs.com/gif.latex?Ecost\_sell[i,t] " alt="Alternate text"/>

    - [Power Consumed Bill](#power-consumed-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill[i,t] " alt="Alternate text"/>

    - [Power Injected Bill](#power-injected-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill[i,t] " alt="Alternate text"/>

- ### Constant return of invesion

  - This sets of constrains limit the return of inversion of the different energy resources.

  - #### Equality in return of inversion disgregated solar

    -S'ha de pensar com fer contar la part de la bateria que despres utilitzen altres.

    - <img src="https://latex.codecogs.com/gif.latex?\frac{\sum_{t=0}^TP\_PV[t,pv]\cdot SF\_PV[i,t,pv]\cdot At \cdot Ecost[i,t]}{Inv\_PV[i,pv]} = \\ \\Payback\_CTE\_PV[pv] \\ \forall i \in I:Inversion[i,pv]>0 ,\forall pv \in PV " alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Period](#period): <img src="https://latex.codecogs.com/gif.latex?At " alt="Alternate text"/>

      - [Photovoltaic plant](#photovoltaic-plant) : <img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

      - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv] " alt="Alternate text"/>

      - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor): <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

      - [Energy Price for Consumption](#energy-price-for-consumption): <img src="https://latex.codecogs.com/gif.latex?Ecost[i,t] " alt="Alternate text"/>

      - [Return of inversion PV constant](#return-of-inversion-pv-constant): <img src="https://latex.codecogs.com/gif.latex?Payback\_CTE\_PV[i,pv] " alt="Alternate text"/>

      - [Inversion PV](#inversion-pv): <img src="https://latex.codecogs.com/gif.latex?Inv\_PV[i,pv] " alt="Alternate text"/>

  - #### Equality in return of inversion disgregated Battery not charged from grid (NO injection)

    - <img src="https://latex.codecogs.com/gif.latex?\frac{\sum_{t=0}^T PBat\_dch[t,bat]\cdot At\cdot SF\_Bat[i,t,bat]\cdot Ecost[i,t]}{Inv\_Bat[i,bat]} = \\ \\Payback\_CTE\_Bat[bat] \\ \forall i \in I:I\_Bat[i,bat]>0 ,\forall pv \in PV " alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Period](#period): <img src="https://latex.codecogs.com/gif.latex?At " alt="Alternate text"/>

      - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

      - [Battery Discharge Power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[t,bat] " alt="Alternate text"/>

      - [Par Battery Sharing Factor](#par-battery-sharing-factor) or [Var Battery Sharing Factor](#var-battery-sharing-factor): <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,pv] " alt="Alternate text"/>

      - [Energy Price for Consumption](#energy-price-for-consumption): <img src="https://latex.codecogs.com/gif.latex?Ecost[i,t] " alt="Alternate text"/>

      - [Return of inversion Bat constant](#return-of-inversion-bat-constant): <img src="https://latex.codecogs.com/gif.latex?Payback\_CTE\_Bat[i,bat] " alt="Alternate text"/>

      - [Battery inversion](#battery-inversion): <img src="https://latex.codecogs.com/gif.latex?Inv\_Bat[i,bat] " alt="Alternate text"/>

  - #### Equality in return of inversion disgregated Battery charged from grid(NO injection)

    - <img src="https://latex.codecogs.com/gif.latex?\frac{\sum_{t=0}^T PBat\_dch[pv,t]\cdot At \cdot SF\_Bat[i,bat,t]\cdot Ecost[i,t]-P\_Bat\_ch[pv,t]\cdot SF\_Bat[i,bat,t]\cdot Ecost[i,t]}{Inv\_Bat[i,bat]} = \\ \\Payback\_CTE\_Bat[bat] \\ \forall i \in I:I\_Bat[i,bat]>0 ,\forall pv \in PV  " alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Period](#period): <img src="https://latex.codecogs.com/gif.latex?At " alt="Alternate text"/>

      - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

      - [Battery Discharge Power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[t,bat] " alt="Alternate text"/>

      - [Battery Charge Power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[t,bat] " alt="Alternate text"/>

      - [Par Battery Sharing Factor](#par-battery-sharing-factor) or [Var Battery Sharing Factor](#var-battery-sharing-factor): <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,pv] " alt="Alternate text"/>

      - [Energy Price for Consumption](#energy-price-for-consumption): <img src="https://latex.codecogs.com/gif.latex?Ecost[i,t] " alt="Alternate text"/>

      - [Return of inversion Bat constant](#return-of-inversion-bat-constant): <img src="https://latex.codecogs.com/gif.latex?Payback\_CTE\_Bat[i,bat] " alt="Alternate text"/>

      - [Battery inversion](#battery-inversion): <img src="https://latex.codecogs.com/gif.latex?Inv\_Bat[i,bat] " alt="Alternate text"/>

- ### Limitations to allow LP

  - #### Limitation to allow LP instead of MILP P_consumed where the Batery price is payed individually x2

    - No sé si s’ha de ficar la part de carga ni com no sé si es pot fer agregat

    - <img src="https://latex.codecogs.com/gif.latex?P\_consumed\_bill[i,t] \leq P\_consumed[i,t] + \\ \sum_{bat=0}^{Bat } PBat\_ch[i,bat]   \cdot SF\_Bat[i,t,bat]  \\ \forall i \in I, \forall t \in T " alt="Alternate text"/>

    - <img src="https://latex.codecogs.com/gif.latex?P\_injected\_bill[i,t] \leq \sum_{pv=0}^{PV}  P\_PV[t,pv] \cdot SF\_PV[i,t,pv] +\\ \sum_{bat=0}^{Bat}  P\_Bat\_dch[t,bat] \cdot SF\_Bat[i,t,bat]\\ \forall i \in I, \forall t \in T " alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Photovoltaic plant](#photovoltaic-plant) : <img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

      - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

      - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor) [pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

      - [Par Battery Sharing Factor](#par-battery-sharing-factor) or [Var Battery Sharing Factor](#var-battery-sharing-factor) [pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] " alt="Alternate text"/>

      - [Battery Charge power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

      - [Battery Disharge power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[i,bat] " alt="Alternate text"/>

      - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv] " alt="Alternate text"/>

      - [Power Consumed](#power-consumed) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed[i,t] " alt="Alternate text"/>

      - [Power Consumed Bill](#power-consumed-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill[i,t] " alt="Alternate text"/>

      - [Power Injected Bill](#power-injected-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill[i,t] " alt="Alternate text"/>

  - #### Limitation to allow LP instead of MILP P_consumed where there is only charging from the solar x2

    - No sé si s’ha de ficar la part de carga ni com no sé si es pot fer agregat

    - <img src="https://latex.codecogs.com/gif.latex?P\_consumed\_bill[i,t] \leq P\_consumed[i,t] \\ \\ \forall i \in I, \forall t \in T " alt="Alternate text"/>

    - <img src="https://latex.codecogs.com/gif.latex?P\_injected[i,t] \leq \sum_{pv=0}^{PV}  P\_PV[t,pv] * SF\_PV[i,t,pv] +\\ \sum_{bat=0}^{Bat}  P\_Bat\_dch[t,bat] * SF\_Bat[i,t,bat]\\ \forall i \in I, \forall t \in T " alt="Alternate text"/>

    - Used parameters and Varibales:

      - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

      - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

      - [Photovoltaic plant](#photovoltaic-plant) : <img src="https://latex.codecogs.com/gif.latex?PV " alt="Alternate text"/>

      - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

      - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) or [Var Photovoltaic Sharing Factor](#var-photovoltaic-sharing-factor) [pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] " alt="Alternate text"/>

      - [Par Battery Sharing Factor](#par-battery-sharing-factor) or [Var Battery Sharing Factor](#var-battery-sharing-factor) [pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] " alt="Alternate text"/>

      - [Battery Disharge power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[i,bat] " alt="Alternate text"/>

      - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv] " alt="Alternate text"/>

      - [Power Consumed](#power-consumed) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed[i,t] " alt="Alternate text"/>

      - [Power Consumed Bill](#power-consumed-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill[i,t] " alt="Alternate text"/>

      - [Power Injected Bill](#power-injected-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill[i,t] " alt="Alternate text"/>

  - #### Limit Max Power PV + Bat only charging from the solar

- ### Battery limitations x7(Battery_limits)

  - #### Minimum Battery constrain

    - <img src="https://latex.codecogs.com/gif.latex?EBat\_min[bat] \le EBat[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - #### Maximum Battery constrain

    - <img src="https://latex.codecogs.com/gif.latex?EBat\_max[bat] \ge EBat[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - #### Maximum Power charge Battery constrain

    - <img src="https://latex.codecogs.com/gif.latex?PBat\_max[bat] \ge PBat\_ch[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - #### Maximum Power discharge Battery constrain

    - <img src="https://latex.codecogs.com/gif.latex?PBat\_max[bat] \ge PBat\_dch[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - #### Battery SOC evolution constrain

    - <img src="https://latex.codecogs.com/gif.latex?EBat[bat,t] = EBat[bat,t-1] + PBat\_ch[bat,t]\cdot At - PBat\_dch[bat,t] \cdot At \quad \forall bat \in Bat, \forall t \in (2,T)  " alt="Alternate text"/>

  - #### Battery SOC evolution init constrain

    - <img src="https://latex.codecogs.com/gif.latex?EBat[bat,1] = EBat\_0[bat] + PBat\_ch[bat,1]\cdot At - PBat\_dch[bat,1]\cdot At \quad \forall bat \in Bat " alt="Alternate text"/>

  - #### Battery SOC final constrain

    - <img src="https://latex.codecogs.com/gif.latex?EBat[bat,T] = EBat\_end[bat] \quad \forall bat \in Bat " alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

    - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

    - [Battery Energy](#battery-energy): <img src="https://latex.codecogs.com/gif.latex?EBat[t,bat] " alt="Alternate text"/>

    - [Battery discharge power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[i,bat] " alt="Alternate text"/>

    - [Battery charge power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

    - [Maximum Battery Power](#maximum-battery-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_max[bat] " alt="Alternate text"/>

    - [Maximum battery energy](#maximum-battery-energy) : <img src="https://latex.codecogs.com/gif.latex?EBat\_max[bat] " alt="Alternate text"/>

    - [Minimum battery energy](#minimum-battery-energy) : <img src="https://latex.codecogs.com/gif.latex?EBat\_min[bat] " alt="Alternate text"/>

    - [Initial Batery level](#initial-batery-level) : <img src="https://latex.codecogs.com/gif.latex?EBat\_0[bat] " alt="Alternate text"/>

    - [Final Batery level](#final-batery-level) : <img src="https://latex.codecogs.com/gif.latex?EBat\_end[bat] " alt="Alternate text"/>

- ### Battery degradation
  
  - <img src="https://latex.codecogs.com/gif.latex?nmax[Bat] \geq \sum^T_{t=0} \frac{(PBat\_ch[t,Bat]+PBat\_dch[t,Bat])\cdot At}{2EBat\_max[Bat]}\\ \forall bat \in Bat " alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

    - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat " alt="Alternate text"/>

    - [Period](#period): <img src="https://latex.codecogs.com/gif.latex?At " alt="Alternate text"/>

    - [Battery discharge power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[i,bat] " alt="Alternate text"/>

    - [Battery charge power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

    - [Maximum battery energy](#maximum-battery-energy) : <img src="https://latex.codecogs.com/gif.latex?EBat\_max[bat] " alt="Alternate text"/>

    - [Maximum daily cicles](#maximum-daily-cicles) : <img src="https://latex.codecogs.com/gif.latex?nmax[Bat] " alt="Alternate text"/>

## Cost Function

- ### Cost Function cost

  - <img src="https://latex.codecogs.com/gif.latex?\min_{\forall P \in \mathbb{R}} \sum_{i=1}^{I} Cost[i] " alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Overall Cost-for-a-Client](#overall-cost-for-a-client): <img src="https://latex.codecogs.com/gif.latex?Cost[i] " alt="Alternate text"/>

- ### Squared_Cost_Function_cost

  - <img src="https://latex.codecogs.com/gif.latex?\min_{\forall P \in \mathbb{R}} \sum_{i=1}^{I} Cost[i]^2 " alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Overall Cost-for-a-Client](#overall-cost-for-a-client): <img src="https://latex.codecogs.com/gif.latex?Cost[i] " alt="Alternate text"/>

- ### Minimizing the energy cost and balancing payback

  - <img src="https://latex.codecogs.com/gif.latex?\min_{\forall P \in \mathbb{R}} \sum_{i=1}^{n_{clients}} \sum_{t=0}^{T} P\_Injected\_bill[i,t]\cdot At \cdot(Ecost[i,t] - Ecost\_sell[i,t])" alt="Alternate text"/>

  - Used parameters and Varibales:

    - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I " alt="Alternate text"/>

    - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T " alt="Alternate text"/>

    - [Period](#period): <img src="https://latex.codecogs.com/gif.latex?At " alt="Alternate text"/>

    - [Energy Price for Consumption](#energy-price-for-consumption): <img src="https://latex.codecogs.com/gif.latex?Ecost[i,t] " alt="Alternate text"/>

    - [Energy Price for Injection](#energy-price-for-injection): <img src="https://latex.codecogs.com/gif.latex?Ecost\_sell[i,t] " alt="Alternate text"/>

    - [Power Injected Bill](#power-injected-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill[i,t] " alt="Alternate text"/>

## Examples of implementation

### Daily optimitzation of a battery operation with solar panels

This op

- #### Parameters daily optimitzation of a battery operation with solar panels

  - [Users](#users): <img src="https://latex.codecogs.com/gif.latex?I=(1) " alt="Alternate text"/>

  - [Time](#time): <img src="https://latex.codecogs.com/gif.latex?T=(1:24 x 3) " alt="Alternate text"/>

  - [Photovoltaic plant](#photovoltaic-plant) : <img src="https://latex.codecogs.com/gif.latex?PV=(1) " alt="Alternate text"/>

  - [Battery](#battery) : <img src="https://latex.codecogs.com/gif.latex?Bat=(1) " alt="Alternate text"/>

  - [Period](#period) : <img src="https://latex.codecogs.com/gif.latex?At=1 " alt="Alternate text"/>

  - [Power Consumed](#power-consumed) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed[i,t]= timeseries\_consumption[1,t] " alt="Alternate text"/>

  - [Energy Price for Consumption](#energy-price-for-consumption): <img src="https://latex.codecogs.com/gif.latex?Ecost[i,t] = PVPC[1,t] " alt="Alternate text"/>

  - [Energy Price for Injection](#energy-price-for-injection): <img src="https://latex.codecogs.com/gif.latex?Ecost\_sell[i,t]=SPOT[1,t] " alt="Alternate text"/>

  - [Photovoltaic Power](#photovoltaic-power) : <img src="https://latex.codecogs.com/gif.latex?P\_PV[t,pv] = timeseries\_solargeneration[t,1] " alt="Alternate text"/>

  - [Par Photovoltaic Sharing Factor](#par-photovoltaic-sharing-factor) [pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_PV[i,t,pv] = 1[1,t,1] " alt="Alternate text"/>

  - [Par Battery Sharing Factor](#par-battery-sharing-factor) [pu]: <img src="https://latex.codecogs.com/gif.latex?SF\_Bat[i,t,bat] = 1[1,t,1] " alt="Alternate text"/>

  - [Maximum Battery Power](#maximum-battery-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_max[bat] = 20000[1] " alt="Alternate text"/>

  - [Maximum battery energy](#maximum-battery-energy) : <img src="https://latex.codecogs.com/gif.latex?EBat\_max[bat] = 2000[1] " alt="Alternate text"/>

  - [Minimum battery energy](#minimum-battery-energy) : <img src="https://latex.codecogs.com/gif.latex?EBat\_min[bat] = 120000[1] " alt="Alternate text"/>

  - [Initial Batery level](#initial-batery-level) : <img src="https://latex.codecogs.com/gif.latex?EBat\_0[bat] = 20000[1] " alt="Alternate text"/>

  - [Final Batery level](#final-batery-level) : <img src="https://latex.codecogs.com/gif.latex?EBat\_end[bat] = 20000[1] " alt="Alternate text"/>

  - [Maximum daily cicles](#maximum-daily-cicles) : <img src="https://latex.codecogs.com/gif.latex?nmax[Bat] = 0.8[1] " alt="Alternate text"/>

- #### Variables daily optimitzation of a battery operation with solar panels

  - [Overall Cost for a Client](#overall-cost-for-a-client): <img src="https://latex.codecogs.com/gif.latex?Cost[i] " alt="Alternate text"/>

  - [Battery Energy](#battery-energy): <img src="https://latex.codecogs.com/gif.latex?EBat[t,bat] " alt="Alternate text"/>

  - [Battery charge power](#battery-charge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_ch[i,bat] " alt="Alternate text"/>

  - [Battery Disharge power](#battery-discharge-power) : <img src="https://latex.codecogs.com/gif.latex?PBat\_dch[i,bat] " alt="Alternate text"/>

  - [Power Consumed Bill](#power-consumed-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Consumed\_bill[i,t] " alt="Alternate text"/>

  - [Power Injected Bill](#power-injected-bill) : <img src="https://latex.codecogs.com/gif.latex?P\_Injected\_bill[i,t] " alt="Alternate text"/>

- #### Constrains daily optimitzation of a battery operation with solar panels

  - [Minimum Batery constrain](#minimum-battery-constrain)

    - <img src="https://latex.codecogs.com/gif.latex?EBat\_min[bat] \le EBat[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - [Maximum Batery constrain](#maximum-battery-constrain)

    - <img src="https://latex.codecogs.com/gif.latex?EBat\_max[bat] \ge EBat[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - [Maximum Power charge Batery constrain](#maximum-power-charge-battery-constrain)

    - <img src="https://latex.codecogs.com/gif.latex?PBat\_max[bat] \ge PBat\_ch[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - [Maximum Power discharge Batery constrain](#maximum-power-discharge-battery-constrain)

    - <img src="https://latex.codecogs.com/gif.latex?PBat\_max[bat] \ge PBat\_dch[bat,t] \quad \forall bat \in Bat " alt="Alternate text"/>

  - [Battery SOC evolution constrain](#battery-soc-evolution-constrain)

    - <img src="https://latex.codecogs.com/gif.latex?EBat[bat,t] = EBat[bat,t-1] + PBat\_ch[bat,t]\cdot At - PBat\_dch[bat,t] \cdot At \quad \forall bat \in Bat, \forall t \in (2,T)  " alt="Alternate text"/>

  - [Battery SOC evolution init constrain](#battery-soc-evolution-init-constrain)

    - <img src="https://latex.codecogs.com/gif.latex?EBat[bat,1] = EBat\_0[bat] + PBat\_ch[bat,1]\cdot At - PBat\_dch[bat,1]\cdot At \quad \forall bat \in Bat " alt="Alternate text"/>

  - [Battery SOC final constrain](#battery-soc-final-constrain)

    - <img src="https://latex.codecogs.com/gif.latex?EBat[bat,T] = EBat\_end[bat] \quad \forall bat \in Bat " alt="Alternate text"/>

  - [Battery degradation](#battery-degradation)

    - <img src="https://latex.codecogs.com/gif.latex?nmax[Bat] \geq \sum^T_{t=0} \frac{(PBat\_ch[t,Bat]+PBat\_dch[t,Bat])\cdot At}{2EBat\_max[Bat]}\\ \forall bat \in Bat " alt="Alternate text"/>

  - [Cost definition](#cost-definition)

    - <img src="https://latex.codecogs.com/gif.latex?Cost[i] = \sum_{t=0}^T P\_Consumed\_bill[i,t] \cdot At \cdot Ecost[i,t]-P\_Injected\_bill[i,t]\cdot At\cdot    Ecost\_sell[i,t] \quad\forall i \in I " alt="Alternate text"/>

  - [Limitation to allow LP instead of MILP P_consumed where the Batery price is payed individually x2](#limitation-to-allow-lp-instead-of-milp-p_consumed-where-the-batery-price-is-payed-individually-x2)

    - <img src="https://latex.codecogs.com/gif.latex?P\_consumed\_bill[i,t] \leq P\_consumed[i,t] + \\ \sum_{bat=0}^{Bat } PBat\_ch[i,bat]   \cdot SF\_Bat[i,t,bat]  \\ \forall i \in I, \forall t \in T " alt="Alternate text"/>

    - <img src="https://latex.codecogs.com/gif.latex?P\_injected\_bill[i,t] \leq \sum_{pv=0}^{PV}  P\_PV[t,pv] \cdot SF\_PV[i,t,pv] +\\ \sum_{bat=0}^{Bat}  P\_Bat\_dch[t,bat] \cdot SF\_Bat[i,t,bat]\\ \forall i \in I, \forall t \in T " alt="Alternate text"/>

- #### Function Cost daily optimitzation of a battery operation with solar panels

  - <img src="https://latex.codecogs.com/gif.latex?\min_{\forall P \in \mathbb{R}} \sum_{i=1}^{I} Cost[i] " alt="Alternate text"/>
